<% content_for :title do %>
  <%= @horse.name %>
<% end %>

<div class="media">

  <div class="media-body">

    <div class="media-section">
      <h1><%= @horse.name %></h1>
    </div>

    <div class="media-section">
      <h2>Description</h2>
      <p><%= @horse.description %></p>
      <br>
      <ul class="list-group">
        <li class="list-group-item">Category: <%= @horse.category.name %></li>
        <li class="list-group-item">Equiped: <%= @horse.equipment %></li>
      </ul>
    </div>

     <div class="media-section">
      <% if @horse.photo? %>
        <%= cl_image_tag @horse.photo.path, width: 500, crop: :fill %>
      <% end %>
    </div>

  </div>

  <div class="media-aside">

    <div class="media-section">
      <h4><%= @horse.address %></h4>
      <div id="map" style="width: 100%; height: 200px"></div>

      <% content_for(:after_js) do %>
        <%= javascript_tag do %>
          $(document).ready(function() {
            var handler = Gmaps.build('Google');
            handler.buildMap({ internal: { id: 'map' } }, function() {
              markers = handler.addMarkers(<%= raw @hash.to_json %>);
              handler.bounds.extendWith(markers);
              handler.fitMapToBounds();
              if (markers.length == 0) {
                handler.getMap().setZoom(2);
              } else if (markers.length == 1) {
                handler.getMap().setZoom(11);
              }
            });
          });
        <% end %>
      <% end %>

    </div>

    <div class="media-section">
      <h4><%= @horse.price %> â‚¬ makes your day!</h4>
      <%= render 'bookings/form' %>
    </div>

    <div class="media-section">
      <h2><%= @horse.stars %></h2>
    </div>


    <div class="media-section">
      <% @horse.bookings.each do |booking| %>
        <% if booking.user_rating %>
          <p><%= booking.stars %> <%= booking.user_comment %> <%= raw " - <strong>#{booking.user.try(:first_name)} #{booking.user.try(:last_name)}.</strong>" if booking.user.try(:first_name) %></p>
        <% end %>
      <% end %>
    </div>
  </div>

</div>

<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).ready(function() {
      var coord = <%= raw @horse_coordinates %>;
      alert('horse coordinates are ' + coord.lat + ', ' + coord.lng);
    });
  <% end %>
<% end %>



